# SquirRL-Auditor 项目介绍

> 📌 本文档帮助团队成员快速理解项目背景、原理和我们的工作贡献

---

## 一、项目背景：什么是自私挖矿？

### 1.1 区块链挖矿的基本原理

在比特币等区块链系统中，**矿工**通过计算来竞争记账权：

```
正常流程：
1. 矿工解决一个数学难题（工作量证明）
2. 谁先解出来，谁就获得记账权
3. 记账成功后，矿工获得区块奖励（比如比特币）
4. 新区块被广播到全网，所有人更新账本
```

**关键规则**：比特币采用"最长链规则"——当出现分叉时，网络选择最长的那条链作为有效链。

### 1.2 自私挖矿攻击（Selfish Mining）

2014年，研究者发现了一种"作弊"策略：

```
自私挖矿策略：
1. 矿工挖到新区块后，不立即公布
2. 偷偷继续在私有链上挖矿
3. 等到合适时机，一次性公布多个区块
4. 让诚实矿工的工作白费
```

**举个例子**：

```
时间线：
t1: 自私矿工挖到区块A，但不公布（藏起来）
t2: 诚实矿工挖到区块B，公布了
t3: 自私矿工又挖到区块C（在A后面）
t4: 自私矿工公布 A→C，链更长！
    诚实矿工的B被丢弃，白挖了！
```

**攻击效果**：
- 自私矿工虽然算力只有35%，但可能获得39%的区块奖励
- 诚实矿工的部分工作被浪费
- 攻击者"以少胜多"

### 1.3 为什么这很重要？

自私挖矿破坏了区块链的核心假设：

| 假设 | 现实 |
|------|------|
| 51%算力才能攻击 | 实际25%就可能获利 |
| 诚实挖矿最优 | 自私策略收益更高 |
| 系统公平激励 | 激励机制存在漏洞 |

这意味着区块链的安全性比我们想象的要低！

---

## 二、SquirRL论文做了什么？

### 2.1 核心思想

**论文标题**：*SquirRL: Automating Attack Analysis on Blockchain Incentive Mechanisms with Deep Reinforcement Learning*

**核心问题**：自私挖矿的最优策略是什么？

传统方法是数学推导，但面对复杂协议很难分析。论文的创新是：

> 🎯 **用AI（深度强化学习）自动发现最优攻击策略**

### 2.2 强化学习方法

把攻击问题建模为一个"游戏"：

```
┌─────────────────────────────────────────┐
│            强化学习框架                  │
├─────────────────────────────────────────┤
│  智能体（Agent）：自私矿工               │
│  环境（Environment）：区块链网络         │
│  状态（State）：当前区块链分叉情况       │
│  动作（Action）：发布/隐藏/等待          │
│  奖励（Reward）：获得的区块数量          │
└─────────────────────────────────────────┘
```

**训练过程**：
1. AI随机尝试不同策略
2. 根据获得的奖励调整策略
3. 经过数十万次尝试，学会最优攻击方式

### 2.3 论文的主要结果

论文验证了：
- **Bitcoin**：25%算力就可能获得超额收益
- **GHOST**：比Bitcoin更安全，需要约30%算力
- **Ethereum**：采用叔块奖励，安全性更好

---

## 三、我们的项目做了什么？

### 3.1 与原项目的对比

| 方面 | 原项目 (SquirRL) | 我们的项目 (SquirRL-Auditor) |
|------|-----------------|------------------------------|
| **技术框架** | TensorFlow 1.x（已过时） | PyTorch + Stable-Baselines3（主流） |
| **环境库** | OpenAI Gym（停止维护） | Gymnasium（官方继任者） |
| **界面** | 无，只有命令行脚本 | **Web可视化平台** |
| **防御研究** | 无 | **UTB防御机制分析** |
| **工具化** | 无 | CLI工具 + Docker部署 |
| **实验管理** | 硬编码参数 | YAML配置文件 |

### 3.2 我们的三大贡献

#### 贡献1️⃣：UTB防御机制研究（研究创新）

**什么是UTB？**

UTB (Uncles-To-Block) 是一种防御自私挖矿的机制：

```
普通Bitcoin：
- 分叉时，矿工随机选择一条链继续挖
- 自私矿工可以利用这个获得优势

UTB机制：
- 分叉时，矿工更倾向于选择有"叔块"的链
- 叔块 = 未被采纳但仍然有效的区块
- 这样可以减少自私矿工的优势
```

**我们的实验**：

测试不同UTB比率（0%, 25%, 50%, 75%, 100%）对攻击效果的影响：

| UTB比率 | 攻击者收益 | 效果 |
|---------|-----------|------|
| 0%（无防御） | 41.9% | 基准 |
| 25% | 41.7% | 略有下降 |
| 50% | 41.6% | 效果最好 |
| 75% | 44.0% | 反而变差 |
| 100% | 44.2% | 适得其反 |

**重要发现**：UTB比率不是越高越好！50%左右效果最佳。

#### 贡献2️⃣：Web可视化平台（工程创新）

原项目只有命令行，我们开发了交互式Web界面：

```
┌──────────────────────────────────────┐
│         SquirRL-Auditor 平台         │
├──────────────────────────────────────┤
│  🏠 首页 - 项目概览                   │
│  🎬 攻击模拟动画 - 直观理解攻击过程    │
│  📈 多协议对比 - 3D曲面图对比安全性   │
│  🛡️ 防御效果评估 - UTB实验结果展示    │
│  🎯 一键演示 - 答辩展示专用           │
└──────────────────────────────────────┘
```

**亮点**：
- 交互式3D图表（可旋转、缩放）
- 攻击过程动画演示
- 实验数据可视化
- 一键演示功能（非常适合答辩！）

#### 贡献3️⃣：技术栈现代化（工程改进）

**为什么要重构？**

原项目使用的TensorFlow 1.x在2023年已停止维护，代码难以运行。

**我们的改进**：

```
代码现代化：
├── PyTorch - 更易调试和理解的深度学习框架
├── Stable-Baselines3 - 工业级强化学习库
├── Gymnasium - OpenAI Gym的官方继任者
└── Streamlit + Plotly - 现代Web可视化

工程化：
├── CLI工具 - 统一的命令行接口
├── YAML配置 - 实验参数可配置
├── Docker - 一键部署
└── 单元测试 - 代码质量保证
```

---

## 四、核心概念解释

### 4.1 三种区块链协议

我们研究了三种不同的区块链共识规则：

#### Bitcoin（比特币）- 最长链规则

```
规则：哪条链最长，就选哪条
特点：简单直观，但容易被自私挖矿利用
安全性：⭐（较低）
```

#### GHOST - 最重子树规则

```
规则：不只看长度，还看"子树的总重量"
特点：考虑了分叉中被丢弃的区块
安全性：⭐⭐⭐（中等）
```

#### Ethereum（以太坊）- 叔块奖励规则

```
规则：被丢弃的区块（叔块）也能获得部分奖励
特点：减少了矿工的损失，降低攻击收益
安全性：⭐⭐⭐⭐（较高）
```

### 4.2 关键参数

| 参数 | 含义 | 取值范围 |
|------|------|---------|
| **α (alpha)** | 攻击者的算力占比 | 0~0.5（超过50%就是51%攻击了） |
| **γ (gamma)** | 网络中"跟随攻击者"的矿工比例 | 0~1 |
| **Relative Reward** | 攻击者实际获得的区块占比 | 理论上应该等于α |

**攻击成功的标志**：
- 如果 Relative Reward > α，说明攻击有效
- 例如：α=35%，但获得39%的奖励，攻击收益 = 39%-35% = 4%

### 4.3 深度强化学习（DRL）

**通俗解释**：

```
想象你在玩一个游戏：
1. 你不知道规则，只能尝试
2. 每次操作后，游戏会告诉你得分
3. 你根据得分调整策略
4. 玩几万次后，你就变成高手了

深度强化学习就是让AI这样"玩游戏"学会最优策略
```

**我们使用的算法**：DQN (Deep Q-Network)

```
核心思想：
1. 用神经网络估计每个动作的"价值"
2. 选择价值最高的动作
3. 根据实际奖励调整网络参数
4. 重复训练直到收敛
```

---

## 五、实验结果总结

### 5.1 训练的模型

| 类别 | 模型数量 | 参数范围 |
|------|---------|---------|
| Bitcoin | 5个 | α = 0.25, 0.30, 0.35, 0.40, 0.45 |
| GHOST | 5个 | α = 0.25, 0.30, 0.35, 0.40, 0.45 |
| Ethereum | 5个 | α = 0.25, 0.30, 0.35, 0.40, 0.45 |
| UTB防御 | 5个 | ratio = 0.0, 0.25, 0.50, 0.75, 1.0 |
| **总计** | **20个** | - |

### 5.2 主要发现

#### 发现1：协议安全性对比

```
安全性排名（从低到高）：
Bitcoin < GHOST < Ethereum

Bitcoin: α=35% → 38.7%奖励（+3.7%）
GHOST:   α=35% → 38.3%奖励（+3.3%）
Ethereum:α=35% → 37.6%奖励（+2.6%）
```

**结论**：Ethereum的叔块奖励机制确实提高了安全性

#### 发现2：UTB防御效果

```
UTB比率与攻击收益：
0%   → 41.9%（无防御）
50%  → 41.6%（最佳防御点）
100% → 44.2%（过度防御反而更差）
```

**结论**：防御机制需要适度，过度反而有害

#### 发现3：攻击阈值

```
各协议的"安全阈值"（攻击开始有利可图的算力占比）：
Bitcoin:  ~25%
GHOST:    ~28%
Ethereum: ~30%
```

---

## 六、项目结构概览

```
SquirRL-Auditor/
│
├── app/                    # Web可视化应用
│   ├── main.py            # 主页面
│   └── pages/             # 各功能页面
│
├── src/                    # 核心代码
│   ├── environment/       # 区块链模拟环境
│   ├── agents/            # 训练和评估
│   └── visualization/     # 图表生成
│
├── models/                 # 训练好的AI模型（20个）
├── results/                # 实验结果数据和图表
├── configs/                # 实验配置文件
│
└── auditor.py              # 命令行工具入口
```

---

## 七、答辩要点提示

### 可以重点讲的内容

1. **问题背景**（1-2分钟）
   - 什么是自私挖矿
   - 为什么这是个安全问题

2. **方法介绍**（2-3分钟）
   - 强化学习的基本思想
   - 如何把攻击建模为RL问题

3. **我们的贡献**（3-4分钟）
   - UTB防御机制研究（研究创新）
   - Web可视化平台（工程创新）
   - 技术栈现代化（工程改进）

4. **实验结果**（2-3分钟）
   - 三协议安全性对比
   - UTB防御效果分析

5. **演示**（2-3分钟）
   - 打开Web平台
   - 展示3D对比图
   - 播放攻击动画

### 可能的提问

| 问题 | 简要回答 |
|------|---------|
| 为什么用强化学习？ | 复杂协议难以数学分析，让AI自动探索最优策略 |
| 和原论文有什么区别？ | 增加了UTB防御研究、Web平台、技术栈现代化 |
| UTB为什么100%效果反而差？ | 过度补偿导致攻击者可以利用叔块获得更多奖励 |
| 这个研究有什么实际意义？ | 帮助区块链设计者评估和改进激励机制安全性 |

---

## 八、快速启动

### 运行Web界面

```bash
cd SquirRL-Auditor
streamlit run app/main.py
```

然后打开浏览器访问 http://localhost:8501

### 查看实验结果

结果图表在 `results/` 目录：
- `three_protocols_comparison.png` - 三协议对比
- `utb_defense_effect.png` - UTB防御效果
- `figure3_real.png` - 复现论文Figure 3

---

## 九、参考资料

1. **原论文**：SquirRL: Automating Attack Analysis on Blockchain Incentive Mechanisms with Deep Reinforcement Learning (NDSS 2020)

2. **自私挖矿**：Majority is not Enough: Bitcoin Mining is Vulnerable (Eyal & Sirer, 2014)

3. **GHOST协议**：Secure High-Rate Transaction Processing in Bitcoin (Sompolinsky & Zohar, 2015)

---

*文档编写日期：2024年12月*
*如有疑问，请联系项目负责人*

